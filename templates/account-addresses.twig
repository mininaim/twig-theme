{% extends "layout.twig" %}

{% block header %} 
  {{ include('header.twig') }} 
{% endblock %}

{% block css_files_inner %}
  <link rel="preload" href="https://cdn.jsdelivr.net/gh/lipis/flag-icons@6.6.6/css/flag-icons.min.css" as="style" onload="this.rel = 'stylesheet'">
{% endblock %}

{% block main_content %}
  {% if customer %}
    <section class="bg-primary text-center py-5" role="hero">
      <div class="container">
        <div class="row">
          <div class="col">
            <div class="text-white">
              <h1 class="h2">
                {{ locals.profile.addresses }}</h1>
            </div>
          </div>
        </div>
      </div>
    </section>
    <section class="border-secondary border-top border-bottom border-opacity-10 py-2">
      <div class="container">
        <div class="d-flex justify-content-center justify-content-sm-end align-items-center animated slideIn">
          <div class="btn-toolbar" role="toolbar" aria-label="{{ locals.accessibility.toolbar_buttons.label }}">
            <a target="_blank" href="/account-addresses/add" class="btn btn-sm btn-outline-secondary">
              <i class="ti ti-address-book align-middle fs-5" aria-hidden="true"></i>
              <span class="px-1">{{ locals.add_new_address }}</span>
              <span class="ti ti-arrow-up-{% if session.lang.code == 'ar' %}left{% else %}right{% endif %} align-middle small" aria-hidden="true"></span>
            </a>
          </div>
        </div>
      </div>
    </section>
    <section class="border-secondary border-bottom border-opacity-10 py-2 pb-0">
      <div class="container">
        <div class="row">
          <div class="col">
            <ul class="nav nav-pills mb-0">
              <li class="nav-item">
                <a class="nav-link text-secondary" href="/account-profile">{{ locals.profile.title }}</a>
              </li>
              <li class="nav-item">
                <a class="nav-link active bg-transparent text-primary border-bottom border-primary rounded-0 hstack gap-2" href="/account-addresses">
                  <span>{{ locals.profile.addresses }}</span>
                  <span class="badge text-bg-primary rounded-pill ms-auto">{{addresses|length }}</span>
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link text-secondary" aria-current="page" href="/account-orders">
                  {{ locals.profile.orders }}
                </a>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </section>
    <section class="py-3" role="page">
      <div class="container">
        <div class="row">
          <div class="col">
            <div class="tab-content" id="accountTabContent">
              <div class="tab-pane fade show active" id="address-tab-pane" role="tabpanel" aria-labelledby="address-tab" tabindex="0">
                {% if addresses|length > 0 %}

                  <div class="row row-cols-1 row-cols-sm-3 row-cols-lg-4 g-3">
                    {% for address in addresses %}
                      <div class="col" id="js-address-{{ address.id }}">
                        <div class="card card-product border-secondary border-opacity-10 shadow-sm position-relative h-100">
                          <div class="card-body">
                            <h6 class="card-title fw-bold text-secondary">
                              {{ address.address_street }}</h6>
                            <p class="card-text text-muted small">
                              {{ session.lang.code == 'ar' ? address.city.ar_name : address.city.en_name }}
                              {{ address.address_district }}
                              -
                             <span class="fi fi-{{address.country.iso_code_2|lower}}"></span> {{ session.lang.code == 'ar' ? address.country.ar_name : address.country.en_name }}
                            </p>
                          </div>
                          <div class="card-footer bg-body-tertiary border-secondary border-opacity-10 d-flex justify-content-between align-items-center">
                            <div class="btn-group btn-group-sm" role="group" aria-label="{{locals.accessibility.button.label}}">
                              <a target="_blank" href="/account-addresses/{{ address.id }}/edit" class="btn btn-outline-secondary" data-bs-placement="bottom" data-bs-html="true" data-bs-toggle="tooltip" data-bs-title="<small>{{ locals.addresses_item_buttons_edit }}</small>">
                                <i class="ti ti-writing align-middle fs-6" aria-hidden="true"></i>
                                <span class="visually-hidden">{{ locals.addresses_item_buttons_edit }}</span>
                              </a>
                              <button type="button" data-id="{{ address.id }}" onclick="deleteAddress(this)" class="btn btn-outline-secondary" data-bs-placement="bottom" data-bs-html="true" data-bs-toggle="tooltip" data-bs-title="<small>{{ locals.addresses_item_buttons_delete }}</small>">
                                <i class="ti ti-x align-middle fs-6" aria-hidden="true"></i>
                                <span class="visually-hidden">{{ locals.addresses_item_buttons_delete }}</span>
                              </button>
                            </div>
                            {% if address.address_lat and address.address_lng %}
                              <a target="_blank" href="https://maps.google.com/?q={{ address.address_lat }},{{ address.address_lng }}" class="link-secondary" data-bs-placement="left" data-bs-html="true" data-bs-toggle="tooltip" data-bs-title="<small>{{ locals.location_on_map }}</small>">
                                <i class="ti ti-compass align-middle fs-6" aria-hidden="true"></i>
                                <span class="visually-hidden">{{ locals.location_on_map }}</span>
                              </a>
                            {% endif %}
                            <span id="js-spinner-{{ address.id }}" class="d-none position-absolute top-0 end-0 mt-2 me-2">
                              <div class="spinner-border spinner-border-sm text-primary" role="status">
                                <span class="visually-hidden">{{ locals.accessibility.spinner.label }}</span>
                              </div>
                            </span>
                          </div>
                        </div>
                      </div>
                    {% endfor %}
                  </div>
                {% else %}
                  <div class="row row-cols-1 g-4">
                    <div class="col">
                      <div class="card border-secondary border-opacity-10 shadow-sm">
                        <div class="card-body">
                          <p class="card-title mb-0 text-muted">
                            <i class="ti ti-refresh-alert align-middle" aria-hidden="true"></i>
                            <span class="px-1">
                              {{ locals.addresses_no_items }}
                            </span>
                          </p>
                        </div>
                      </div>
                    </div>
                  </div>
                {% endif %}
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    {% include 'toast.twig'%}
    
  {% else %}
    <section class="py-5" role="alert">
      <div class="container">
        <div class="row">
          <div class="col-sm-4 mx-auto">
            <div class="d-grid justify-content-center align-content-center text-center">
              <p class="mb-0 text-secondary">
                <svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-lock" width="80" height="80" viewbox="0 0 24 24" stroke-width="1" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                  <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
                  <rect x="5" y="11" width="14" height="10" rx="2"></rect>
                  <circle cx="12" cy="16" r="1"></circle>
                  <path d="M8 11v-4a4 4 0 0 1 8 0v4"></path>
                </svg>
              </p>
              <h6 class="mb-3 mt-3 mt-sm-3 mb-sm-4 animate__animated animate__delay-0s animate__fadeInDown">
                {{ locals.system.locked }}
              </h6>
              <p class="animate__animated animate__delay-1s animate__fadeInUp">
                <a href="/auth/login" class="btn btn-primary grow">
                  <span class="px-1">
                    {{ locals.login }}
                  </span>
                  <i class="ti ti-arrow-{% if session.lang.code == 'ar' %}left{% else %}right{% endif %} align-middle" aria-hidden="true"></i>
                </a>
              </p>
            </div>
          </div>
        </div>
      </div>
    </section>
  {% endif %}
{% endblock %}

{% block footer %} 
  {{ include('footer.twig') }} 
{% endblock %}

{% block footer_scripts %}
  <script id="dataTemplateAddress" type="x-tmpl-mustache">
    {{ locals.addresses_deleted }}
  </script>
  <script defer src="{{ assetUrl('mustache.js') }}"></script>
  <script defer src="{{ assetUrl('addresses.js') }}"></script>
{% endblock %}
