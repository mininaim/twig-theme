{% extends "layout.twig" %}

{% block header %}
    {{ include('header.twig') }} 
{% endblock %}

{% block js_files_inner %}
<script defer src="{{ assetUrl('tablesort.js') }}"></script>
<script defer src="{{ assetUrl('tablesort.number.js') }}"></script>
{% endblock %}

{% block main_content %}

<section class="bg-primary text-center py-5">
	<div class="container">
		<div class="row">
			<div class="col">
				<div class="text-white">
					<h1 class="h2">
						{{ locals.header_delivery_and_payment_options}}
					</h1>
				</div>
			</div>
		</div>
	</div>
</section>
{# <section class="border-secondary border-top border-bottom border-opacity-10 py-2 d-none d-lg-block">
        <div class="container">
            <div class="d-flex justify-content-center justify-content-sm-end align-items-center animated slideIn">
                <div class="btn-group btn-group-sm" role="group" aria-label="{{ locals.accessibility.group_buttons.label }}">
                    <button type="button" class="btn btn-outline-secondary js-toggle d-flex align-items-center">
                        <i class="ti ti-stack-push align-middle fs-6" aria-hidden="true"></i>
                        <span class="px-1">{{ locals.shipping_and_payment_tools_change_display }}</span>
                        <span class="spinner-border spinner-border-sm text-light-subtle d-none" role="status">
                            <span class="visually-hidden">
                                {{ locals.accessibility.spinner.label }}
                            </span>
                        </span>
                    </button>
                </div>
            </div>
        </div>
 </section> #}
<section class="py-3">
	<div class="container">
		<div class="row">
			<div class="col">
				<div class="accordion card card-product bg-transparent mt-2 mt-sm-2 shadow-sm border-secondary border-opacity-10 animated slideIn" id="paymentMethodsAccordion">
					<div class="accordion-item">
						<h2 class="accordion-header">
							<button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTable" aria-expanded="false" aria-controls="collapseTable">
								<p class="fs-1 mb-0 d-flex text-secondary">
									<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-wallet" width="30" height="30" viewbox="0 0 24 24" stroke-width="1.5" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
										<path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
										<path d="M17 8v-3a1 1 0 0 0 -1 -1h-10a2 2 0 0 0 0 4h12a1 1 0 0 1 1 1v3m0 4v3a1 1 0 0 1 -1 1h-12a2 2 0 0 1 -2 -2v-12"></path>
										<path d="M20 12v4h-4a2 2 0 0 1 0 -4h4"></path>
									</svg>
									<span class="visually-hidden">{{ locals.shipping_section_payment}}</span>
									<span class="d-inline-block bg-primary bg-opacity-10 rounded-pill"></span>
								</p>
								<div class="ms-3">
									<h6 class="card-title text-muted mb-0 hstack gap-2">
										{{ locals.shipping_section_payment}}
										<span class="badge text-bg-primary rounded-pill ms-auto">{{ store.payment_methods|length }}</span>

									</h6>
									<p class="card-text text-secondary" hidden>
										{{ locals.shipping_section_payment_desc}}
									</p>
								</div>
							</button>
						</h2>
						<div id="collapseTable" class="accordion-collapse collapse" data-bs-parent="#paymentMethodsAccordion">
							<div class="accordion-body">
								<div class="d-flex justify-content-start">
									<div class="spinner-border spinner-border-sm text-primary js-spinner-collapseTable" role="status">
										<span class="visually-hidden">{{ locals.accessibility.spinner.label }}</span>
									</div>
								</div>
								<div class="animated slideIn js-data-collapseTable" style="display: none;">
									<div class="row row-cols-2 row-cols-sm-3 row-cols-lg-6 d-flex flex-wrap justify-content-start gap-sm-4 g-2 animate__animated animate__fadeIn">
										{% for paymentMethod in store.payment_methods %}
											<div class="col mb-0">
												<div class="card h-100 shadow-sm border-secondary border-opacity-10 transform-on-hover">
													<div class="card-body d-flex flex-column justify-content-center align-items-center">
														{% set paymentName = paymentMethod.name|split('_') %}
														<img src="{{ imageUrl(paymentMethod.icon,{ h:100, q: 100 }) }}" alt="{{ paymentName.0 }}" class="css-payment-icon">
														<h6 class="card-title text-center mt-2 text-capitalize">{{ paymentName.0 }}</h6>
													</div>
												</div>
											</div>
										{% endfor %}
									</div>

								</div>
							</div>
						</div>
					</div>
				</div>

				<div class="accordion card card-product bg-transparent mt-2 mt-sm-2 shadow-sm border-secondary border-opacity-10 animated slideIn" id="shippingMethodsAccordion">
					<div class="accordion-item">
						<h2 class="accordion-header">
							<button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTableShipping" aria-expanded="false" aria-controls="collapseTableShipping">
								<p class="fs-1 mb-0 d-flex text-secondary">
									<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-truck-loading" width="30" height="30" viewbox="0 0 24 24" stroke-width="1.5" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
										<path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
										<path d="M2 3h1a2 2 0 0 1 2 2v10a2 2 0 0 0 2 2h15"></path>
										<rect x="9" y="6" width="10" height="8" rx="3"></rect>
										<circle cx="9" cy="19" r="2"></circle>
										<circle cx="18" cy="19" r="2"></circle>
									</svg>
									<span class="visually-hidden">{{ locals.shipping_section_shipping }}</span>
									<span class="d-inline-block bg-primary bg-opacity-10 rounded-pill"></span>
								</p>
								<div class="ms-3">
									<h6 class="card-title text-muted mb-0 hstack gap-2">
										{{ locals.shipping_section_shipping }}
										<span class="badge text-bg-primary rounded-pill ms-auto">{{ store.shipping_methods|length }}</span>

									</h6>
									<p class="card-text text-secondary" hidden>
										{{ locals.shipping_section_shipping_desc }}
									</p>
								</div>
							</button>
						</h2>
						<div id="collapseTableShipping" class="accordion-collapse collapse" data-bs-parent="#shippingMethodsAccordion">
							<div class="accordion-body">
								<div class="d-flex justify-content-start">
									<div class="spinner-border spinner-border-sm text-primary js-spinner-collapseTableShipping" role="status">
										<span class="visually-hidden">{{ locals.accessibility.spinner.label }}</span>
									</div>
								</div>
								<div class="table-responsive animated slideIn js-data-collapseTableShipping" style="display: none;">
									{% if store_shipping_methods %}
										<table class="table table-sm" id="js-shipping-sortable">
											<thead>
												<tr>
													<th scope="col"></th>
													<th scope="col"></th>
													<th scope="col">{{ locals.shipping.cities }}</th>
													{# <th scope="col">
													                    {{ locals.shipping.codEnabled }}
													                  </th> #}
													<th scope="col" class="sortable-column">
														<span class="px-0 d-none d-sm-inline-block">
															<svg aria-hidden="true" width="15" height="15" viewbox="0 0 15 15" fill="none" xmlns="http://www.w3.org/2000/svg">
																<path d="M4.93179 5.43179C4.75605 5.60753 4.75605 5.89245 4.93179 6.06819C5.10753 6.24392 5.39245 6.24392 5.56819 6.06819L7.49999 4.13638L9.43179 6.06819C9.60753 6.24392 9.89245 6.24392 10.0682 6.06819C10.2439 5.89245 10.2439 5.60753 10.0682 5.43179L7.81819 3.18179C7.73379 3.0974 7.61933 3.04999 7.49999 3.04999C7.38064 3.04999 7.26618 3.0974 7.18179 3.18179L4.93179 5.43179ZM10.0682 9.56819C10.2439 9.39245 10.2439 9.10753 10.0682 8.93179C9.89245 8.75606 9.60753 8.75606 9.43179 8.93179L7.49999 10.8636L5.56819 8.93179C5.39245 8.75606 5.10753 8.75606 4.93179 8.93179C4.75605 9.10753 4.75605 9.39245 4.93179 9.56819L7.18179 11.8182C7.35753 11.9939 7.64245 11.9939 7.81819 11.8182L10.0682 9.56819Z" fill="currentColor" fill-rule="evenodd" clip-rule="evenodd"></path>
															</svg>
														</span>
														<span class="px-0 d-none d-sm-inline-block">{{ locals.shipping.codFee }}</span>
														<span class="px-1 d-sm-none">{{ locals.shipping.codFee_short }}</span>
													</th>
													<th scope="col" class="sortable-column">
														<span class="px-0 d-none d-sm-inline-block">
															<svg aria-hidden="true" width="15" height="15" viewbox="0 0 15 15" fill="none" xmlns="http://www.w3.org/2000/svg">
																<path d="M4.93179 5.43179C4.75605 5.60753 4.75605 5.89245 4.93179 6.06819C5.10753 6.24392 5.39245 6.24392 5.56819 6.06819L7.49999 4.13638L9.43179 6.06819C9.60753 6.24392 9.89245 6.24392 10.0682 6.06819C10.2439 5.89245 10.2439 5.60753 10.0682 5.43179L7.81819 3.18179C7.73379 3.0974 7.61933 3.04999 7.49999 3.04999C7.38064 3.04999 7.26618 3.0974 7.18179 3.18179L4.93179 5.43179ZM10.0682 9.56819C10.2439 9.39245 10.2439 9.10753 10.0682 8.93179C9.89245 8.75606 9.60753 8.75606 9.43179 8.93179L7.49999 10.8636L5.56819 8.93179C5.39245 8.75606 5.10753 8.75606 4.93179 8.93179C4.75605 9.10753 4.75605 9.39245 4.93179 9.56819L7.18179 11.8182C7.35753 11.9939 7.64245 11.9939 7.81819 11.8182L10.0682 9.56819Z" fill="currentColor" fill-rule="evenodd" clip-rule="evenodd"></path>
															</svg>
														</span>
														<span class="px-0 d-none d-sm-inline-block">{{ locals.shipping.cost }}</span>
														<span class="px-1 d-sm-none">{{ locals.shipping.cost_short }}</span>
													</th>
													<th scope="col">
														<span class="d-none d-sm-inline-block">{{ locals.shipping.courierNames }}</span>
													</th>
												</tr>
											</thead>
											<tbody>
												{% for shippingMethod in store_shipping_methods %}
													<tr class="animate__animated animate__fadeIn">
														<td>
															<img src="{{ imageUrl(shippingMethod.image,{ h: 100, q: 100 }) }}" loading="lazy" class="logo-w-h-30 js-shipping-icon" alt="{{ shippingMethod.name }}">
														</td>
														<td>
															<span class="d-none d-sm-inline-block">
																{{ shippingMethod.name }}
															</span>
														</td>
														<td>
															<ul class="list-inline mb-0">
																{% set cities = shippingMethod.delivery_option_cities|slice(0, 1) %}
																{% for city in cities %}
																	<li class="list-inline-item">{{ city.name }}</li>
																{% endfor %}
																{% set remainingCities = shippingMethod.delivery_option_cities|length - 1 %}
																{% if remainingCities > 0 %}
																	<li class="list-inline-item list-inline-item-action text-muted">
																		<button data-id="{{ shippingMethod.id }}" class="btn btn-sm btn-link link-primary px-0" type="button" data-bs-toggle="modal" data-bs-target="#modalAllCities">
																			<i class="ti ti-dots align-middle" aria-hidden="true" data-bs-toggle="tooltip" data-bs-placement="top" title="+ {{ remainingCities }} {{ locals.shipping.remainingCities }}"></i>
																			<span class="visually-hidden">+
																				{{ remainingCities }}
																				{{ locals.shipping.remainingCities }}
																			</span>
																		</button>
																	</li>
																{% endif %}
															</ul>
															<div class="list-group list-group-flush overflow-auto" data-cities="{{ shippingMethod.id }}" hidden>
																{% for city in shippingMethod.delivery_option_cities %}
																	<div class="list-group-item border-secondary-subtle py-1">{{ city.name }}</div>
																{% endfor %}
															</div>
														</td>
														{# <td>
														                      {% if shippingMethod.cod_enabled %}
														                        <i class="ti ti-check fs-6 align-middle" aria-hidden="true"></i>
														                        <span class="visually-hidden">{{ locals.shipping.codEnabled }}</span>
														                      {% else %}
														                        <i class="ti ti-x text-secondary fs-6 align-middle" aria-hidden="true">
														                          <span class="visually-hidden">{{ locals.shipping.codDisabled }}</span>
														                        {% endif %}
														                      </td>
														                    </td> #}
														<td>
															<ul class="list-inline mb-0">
																{% for fee in shippingMethod.cod_fee %}
																	<li class="list-inline-item">
																		<span class="badge bg-success bg-opacity-25 text-success-emphasis">{{ fee.cod_fee_string }}</span>
																	</li>
																{% endfor %}
															</ul>
														</td>
														<td>
															<ul class="list-inline mb-0">
																{% for cost in shippingMethod.cost %}
																	<li class="list-inline-item">
																		<small class="px-1">{{ cost.title }}</small>
																		<span class="badge bg-warning bg-opacity-25 text-warning-emphasis">{{ cost.cost_string }}</span>
																	</li>
																{% endfor %}
															</ul>
														</td>
														<td>
															<ul class="list-inline mb-0 d-none d-sm-inline-block">
																{% set maxIconsToShow = 3 %}
																{% set remainingIconsCount = shippingMethod.courier_icons|length - maxIconsToShow %}

																{% for icon in shippingMethod.courier_icons|slice(0, maxIconsToShow) %}
																	<li class="list-inline-item">
																		<img src="{{ imageUrl(icon.icon,{ h: 100, q: 100 }) }}" alt="{{ session.lang.code == 'ar' ? icon.name.ar : icon.name.en }}" class="logo-40" data-bs-toggle="tooltip" data-bs-placement="top" data-bs-title="<small>{{ session.lang.code == 'ar' ? icon.name.ar : icon.name.en }}</small>" data-bs-html="true">
																	</li>
																{% endfor %}

																{% if remainingIconsCount > 0 %}
																	<li class="list-inline-item list-inline-item-action text-muted">
																		<a class="btn btn-sm btn-link link-primary px-0" type="button">
																			<i class="ti ti-dots align-middle" aria-hidden="true" data-bs-toggle="tooltip" data-bs-placement="top" title="+ {{ remainingIconsCount }} {{ locals.shipping.remainingShipping }}"></i>
																			<span class="visually-hidden">+
																				{{ remainingIconsCount }}
																				{{ locals.shipping.remainingShipping }}</span>
																		</a>
																	</li>
																{% endif %}
															</ul>
														</td>

													</tr>
												{% endfor %}
											</tbody>
										</table>
									{% else %}
										<p class="mb-0 text-body-secondary">{{ locals.shipping.no_data }}</p>
									{% endif %}
								</div>
							</div>
						</div>
					</div>
				</div>

				<div class="accordion card card-product bg-transparent mt-2 mt-sm-2 shadow-sm border-secondary border-opacity-10 animated slideIn" id="banksAccordion">
					<div class="accordion-item">
						<h2 class="accordion-header">
							<button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTableBanks" aria-expanded="false" aria-controls="collapseTableBanks">
								<p class="fs-1 mb-0 d-flex text-secondary">
									<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-building-bank" width="30" height="30" viewbox="0 0 24 24" stroke-width="1.5" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
										<path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
										<line x1="3" y1="21" x2="21" y2="21"></line>
										<line x1="3" y1="10" x2="21" y2="10"></line>
										<polyline points="5 6 12 3 19 6"></polyline>
										<line x1="4" y1="10" x2="4" y2="21"></line>
										<line x1="20" y1="10" x2="20" y2="21"></line>
										<line x1="8" y1="14" x2="8" y2="17"></line>
										<line x1="12" y1="14" x2="12" y2="17"></line>
										<line x1="16" y1="14" x2="16" y2="17"></line>
									</svg>
									<span class="visually-hidden">{{ locals.shipping_section_banks }}</span>
								</p>
								<div class="ms-3">
									<h6 class="card-title text-muted mb-0 hstack gap-2">
										{{ locals.shipping_section_banks }}
										<span class="badge text-bg-primary rounded-pill ms-auto">{{ store_banks|length }}</span>
									</h6>
									<p class="card-text text-secondary" hidden>
										{{ locals.shipping_section_banks_desc }}
									</p>
								</div>
							</button>
						</h2>
						<div id="collapseTableBanks" class="accordion-collapse collapse" data-bs-parent="#banksAccordion">
							<div class="accordion-body">
								<div class="d-flex justify-content-start">
									<div class="spinner-border spinner-border-sm text-primary js-spinner-collapseTableBanks" role="status">
										<span class="visually-hidden">{{ locals.accessibility.spinner.label }}</span>
									</div>
								</div>
								<div class="table-responsive animated slideIn js-data-collapseTableBanks" style="display: none;">
									<table class="table" id="js-banks-data">
										<thead>
											<tr>
												<th scope="col"></th>
												<th scope="col">{{ locals.banks.beneficiaryName }}</th>
												<th scope="col">{{ locals.banks.accountNumber }}</th>
												<th scope="col">{{ locals.banks.iban }}</th>
												<th scope="col">
													<div class="d-none d-sm-inline-block">
														{{ locals.banks.bank }}
													</div>
												</th>
												<th></th>
											</tr>
										</thead>
										<tbody>
											{% for bank in store_banks %}
												<tr class="animate__animated animate__fadeIn">
													<th scope="row">
														<i class="ti ti-moneybag align-middle" aria-hidden="true"></i>
														<span class="visually-hidden">{{ locals.banks.id }}</span>
													</th>
													<td>{{ bank.beneficiary_name }}</td>
													<td>{{ bank.account_number }}</td>
													<td>{{ bank.iban }}</td>
													<td>
														<div class="d-none d-sm-inline-block">
															{% if bank.bank %}
																<img class="img-fluid logo-60 css-mode-toggle" src="{{ imageUrl(bank.bank.logo ,{ h: 100, q: 100 }) }}" alt="{{ session.lang.code == 'ar' ? bank.bank.name : bank.bank.name }}" data-bs-toggle="tooltip" data-bs-placement="left" data-bs-title="<small>{{ bank.bank.name }}</small>" data-bs-html="true">
															{% endif %}
														</div>
													</td>
													<td>
														<span class="d-sm-none">
															{{ bank.bank.name }}
														</span>
													</td>
												</tr>
											{% endfor %}
										</tbody>
									</table>
									{% if store_banks|length > 0 %}
										<div class="d-flex justify-content-center mt-3 d-sm-flex animate__animated animate__fadeIn animate__delay-1s">
											<button type="button" class="btn btn-sm btn-primary" id="js-btn-export" onclick="exportData()">
												<i class="ti ti-file-export align-middle" aria-hidden="true"></i>
												<span class="px-1">
													{{ locals.shipping_section_banks_export }}
												</span>
											</button>
										</div>
									{% endif %}
								</div>
							</div>
						</div>
					</div>
				</div>

			</div>
		</div>
	</div>
</section>
<div class="modal fade" id="modalAllCities" tabindex="-1" aria-labelledby="modalAllCitiesLabel" aria-hidden="true">
	<div class="modal-dialog modal-dialog-centered">
		<div class="modal-content border-0">
			<div class="modal-header text-secondary fw-bold border-secondary border-opacity-10">
				<h5 class="modal-title" id="modalAllCitiesLabel">
					<input type="text" class="form-control" id="searchInput" onkeyup="filterList()" placeholder="{{ locals.shipping.modal_search_placeholeer}}">
				</h5>
				<button type="button" class="btn-none p-0 text-body-emphasis grow" data-bs-dismiss="modal" aria-label="{{locals.accessibility.close.label}}">
					<i class="ti ti-x align-middle fs-5"></i>
				</button>
			</div>
			<div class="modal-body">
				<div class="card p-0 border-0 text-text-emphasis">
					<div class="spinner-border spinner-border-sm text-primary d-none js-spinner-cities" role="status">
						<span class="visually-hidden">{{ locals.accessibility.spinner.label }}</span>
					</div>
					<div class="js-scrollable-element overflow-auto" data-simplebar data-simplebar-direction="{% if session.lang.code == 'ar' %}rtl{% else %}ltr{% endif %}" style="max-height: 200px">
						<div class="js-data-cities"></div>
					</div>
				</div>
			</div>
			<div class="modal-footer vstack text-center bg-light-subtle border-top border-secondary-subtle">
				<span class="px-1 small text-light-emphasis">{{ locals.shipping.modal_info }}</span>
			</div>
		</div>
	</div>
</div>

{% endblock %}

{% block footer_scripts %}

<!-- !ToDo: to use mustache.js later -->
<script>
	var shippingDataTemplate = {
    shipping_and_payment_tools_collapse: '{{ locals.shipping_and_payment_tools_collapse }}',
    shipping_and_payment_tools_expand: '{{ locals.shipping_and_payment_tools_expand }}',
    data_file_title: '{{ locals.shipping_section_banks }}-  {{ store.name }}',
    data_export: '{{ locals.shipping_section_banks_export }}',
    data_exporting: '{{ locals.shipping_section_banks_exporting }}'
  };
</script>
<script defer src="{{ assetUrl('shipping-and-payments.js') }}"></script>
<script defer src="{{ assetUrl('FileSaver.min.js') }}"></script>

{% endblock %}

{% block footer %} 
    {{ include('footer.twig') }} 
{% endblock %}